# üìã PROCESSO DE INTEGRA√á√ÉO DE M√ìDULOS - FLUYT

> **√öltima atualiza√ß√£o:** 2025-01-26  
> **Objetivo:** Padronizar e organizar o processo completo de integra√ß√£o de novos m√≥dulos

## üéØ VIS√ÉO GERAL

Este documento define o processo completo para integrar um novo m√≥dulo ao sistema Fluyt, desde a descoberta da estrutura no banco at√© a valida√ß√£o final com dados reais.

## ‚ö†Ô∏è IMPORTANTE: PAPEL DO CLAUDE CODE

### **O que Claude Code FAZ:**
- ‚úÖ **ANALISA** requisitos e estruturas existentes
- ‚úÖ **CRIA** documenta√ß√£o detalhada (arquivos de miss√£o)
- ‚úÖ **DELEGA** tarefas para IAs especializadas
- ‚úÖ **REVISA** c√≥digo implementado pelas equipes
- ‚úÖ **ATRIBUI NOTA** (1-10) com crit√©rios de s√™nior
- ‚úÖ **DECIDE** se cria demanda de refatora√ß√£o ou refatora

### **O que Claude Code N√ÉO FAZ:**
- ‚ùå **N√ÉO implementa** c√≥digo diretamente
- ‚ùå **N√ÉO edita** arquivos .py, .tsx, .ts
- ‚ùå **N√ÉO executa** comandos npm, pip, etc
- ‚ùå **N√ÉO faz** commits no git

### **Processo de Revis√£o e Nota:**
1. **Revisa c√≥digo** implementado pela equipe
2. **Atribui nota 1-10** (como s√™nior conservador)
3. **Se nota < 7:** Cria demanda detalhada de refatora√ß√£o
4. **Se nota ‚â• 7 com ajustes pequenos:** Pode refatorar diretamente
5. **Sempre pergunta ao Ricardo** antes de refatorar

### **Pap√©is e Responsabilidades**

| Papel | Respons√°vel | Fun√ß√£o |
|-------|-------------|---------|
| **Gerente** | Claude Code | Coordena, analisa, documenta e revisa |
| **Backend** | IA Backend | Implementa API REST (Python/FastAPI) |
| **Frontend** | IA Frontend | Implementa interface (Next.js/React) |
| **Integra√ß√£o** | IA Testes | Valida fluxo completo e testes |
| **Aprovador** | Ricardo | Valida cada fase antes de prosseguir |

### **Fluxo Visual**

```mermaid
graph LR
    A[Descoberta] --> B{Ricardo Aprova?}
    B -->|Sim| C[Backend]
    B -->|N√£o| A
    C --> D[Frontend]
    C --> E[Integra√ß√£o]
    D --> F[Valida√ß√£o Final]
    E --> F
    F --> G{Ricardo Aprova?}
    G -->|Sim| H[Conclu√≠do]
    G -->|N√£o| D
```

---

## üìä FASE 1: DESCOBERTA E VALIDA√á√ÉO

**Respons√°vel:** Claude Code (Gerente)  
**Dura√ß√£o:** 1-2 horas  
**Gate:** Aprova√ß√£o do Ricardo

### **Objetivos**
- Entender estrutura real da tabela no Supabase
- Mapear relacionamentos com outras tabelas
- Identificar diferen√ßas entre backend e frontend
- Validar viabilidade t√©cnica

### **Checklist de Descoberta**

#### 1.1 An√°lise do Banco via MCP
```python
# Descobrir tabela real
python3 -c "
from core.database import get_database
db = get_database()
# Verificar se tabela existe e estrutura
"
```

- [ ] Nome real da tabela identificado
- [ ] Campos e tipos mapeados
- [ ] Constraints e √≠ndices documentados
- [ ] RLS (Row Level Security) analisado

#### 1.2 An√°lise do Frontend
```bash
# Verificar interfaces TypeScript
grep -r "interface.*[Modulo]" Frontend/src/types/
```

- [ ] Interfaces TypeScript localizadas
- [ ] Campos do formul√°rio mapeados
- [ ] Convers√£o camelCase ‚Üî snake_case identificada

#### 1.3 Mapeamento de Relacionamentos
- [ ] Foreign keys identificadas
- [ ] Tabelas relacionadas mapeadas
- [ ] Hierarquia definida (ex: Empresa ‚Üí Loja ‚Üí Setor)
- [ ] Multi-tenant considerado (isolamento por loja)

#### 1.4 Documento de Valida√ß√£o
```markdown
## DESCOBERTA - M√ìDULO [NOME]

### Tabela Principal
- Nome: cad_[modulo]
- Campos: [lista completa]

### Relacionamentos
- Relaciona com: [tabelas]
- Tipo: [1:N, N:N, etc]

### Diferen√ßas Backend x Frontend
| Frontend | Backend | A√ß√£o |
|----------|---------|------|
| campo | campo_id | Converter |

### Riscos Identificados
- [Lista de poss√≠veis problemas]
```

### **üî¥ GATE: Apresentar descoberta ao Ricardo**
- Aguardar aprova√ß√£o antes de prosseguir
- Ajustar conforme feedback
- Documentar decis√µes tomadas

---

## ‚öôÔ∏è FASE 2: IMPLEMENTA√á√ÉO BACKEND

**Respons√°vel:** IA Backend  
**Dura√ß√£o:** 3-4 horas  
**Gate:** API funcionando com testes
**Depend√™ncias:** Fase 1 aprovada

### **Objetivos**
- Criar estrutura completa do m√≥dulo backend
- Implementar CRUD com valida√ß√µes
- Respeitar padr√µes estabelecidos
- Entregar API REST test√°vel

### **Arquivos a Criar**

```
backend/modules/[modulo]/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ schemas.py      # Estruturas Pydantic
‚îú‚îÄ‚îÄ repository.py   # Acesso ao banco
‚îú‚îÄ‚îÄ services.py     # L√≥gica de neg√≥cio
‚îî‚îÄ‚îÄ controller.py   # Endpoints FastAPI
```

### **Checklist Backend**

#### 2.1 Schemas (schemas.py)
- [ ] BaseModel com campos obrigat√≥rios/opcionais
- [ ] Valida√ß√µes customizadas (@field_validator)
- [ ] Classes: Create, Update, Response, ListResponse
- [ ] Filtros para listagem

#### 2.2 Repository (repository.py)
- [ ] CRUD completo (Create, Read, Update, Delete)
- [ ] Soft delete implementado
- [ ] Queries otimizadas (evitar N+1)
- [ ] Tratamento de exce√ß√µes espec√≠ficas
- [ ] Multi-tenant se aplic√°vel

#### 2.3 Services (services.py)
- [ ] Valida√ß√µes de neg√≥cio
- [ ] Verifica√ß√£o de permiss√µes
- [ ] Integra√ß√£o com repository
- [ ] Logs adequados

#### 2.4 Controller (controller.py)
- [ ] Endpoints RESTful padr√£o
- [ ] Documenta√ß√£o OpenAPI
- [ ] Pagina√ß√£o implementada
- [ ] Filtros funcionando
- [ ] Autentica√ß√£o obrigat√≥ria

### **Padr√µes Obrigat√≥rios**
- Usar m√≥dulo **Lojas** como refer√™ncia
- Coment√°rios em PT-BR
- Exceptions customizadas
- Logs em pontos cr√≠ticos

### **Testes B√°sicos**
```bash
# Testar endpoints
curl -X GET http://localhost:8000/api/v1/[modulo]
curl -X POST http://localhost:8000/api/v1/[modulo]
```

### **üü° GATE: Backend funcionando**
- Endpoints respondendo corretamente
- CRUD completo testado
- Pode liberar Frontend e Integra√ß√£o

---

## üé® FASE 3A: IMPLEMENTA√á√ÉO FRONTEND

**Respons√°vel:** IA Frontend  
**Dura√ß√£o:** 4-5 horas  
**Gate:** Interface funcionando com dados reais
**Depend√™ncias:** Backend pronto

### **Objetivos**
- Remover TODOS os dados mockados
- Conectar com API real do backend
- Implementar UI/UX consistente
- Integrar com gerenciamento de estado

### **Componentes a Criar/Atualizar**

```
Frontend/src/
‚îú‚îÄ‚îÄ types/[modulo].ts           # Interfaces TypeScript
‚îú‚îÄ‚îÄ hooks/modulos/[modulo]/     # Hooks customizados
‚îú‚îÄ‚îÄ components/modulos/[modulo]/ # Componentes React
‚îú‚îÄ‚îÄ services/[modulo]-service.ts # Chamadas API
‚îî‚îÄ‚îÄ store/[modulo]-store.ts     # Estado Zustand
```

### **Checklist Frontend**

#### 3.1 Tipos e Interfaces
- [ ] Interfaces alinhadas com backend
- [ ] Convers√£o camelCase implementada
- [ ] Tipos para filtros e pagina√ß√£o

#### 3.2 Servi√ßos
- [ ] Integra√ß√£o com apiClient
- [ ] Tratamento de erros
- [ ] Convers√£o de dados autom√°tica
- [ ] Cache quando apropriado

#### 3.3 Componentes
- [ ] Listagem com tabela/cards
- [ ] Formul√°rio de cria√ß√£o/edi√ß√£o
- [ ] Modal de confirma√ß√£o para exclus√£o
- [ ] Filtros e busca
- [ ] Loading states
- [ ] Empty states
- [ ] Error boundaries

#### 3.4 Estado e Store
- [ ] Store Zustand criada
- [ ] Actions CRUD implementadas
- [ ] Loading/error states
- [ ] Persist√™ncia quando necess√°rio

### **Remo√ß√£o de Mocks**
```typescript
// ‚ùå REMOVER
const mockData = [{ id: 1, name: 'Teste' }];

// ‚úÖ SUBSTITUIR POR
const { data, loading, error } = useModulo();
```

### **UI/UX Consistente**
- Usar componentes do Shadcn/ui
- Seguir padr√µes visuais existentes
- Responsividade obrigat√≥ria
- Feedback visual para a√ß√µes

### **üü° GATE: Frontend funcionando**
- Telas carregando dados reais
- CRUD funcionando visualmente
- Sem erros no console

---

## üß™ FASE 3B: TESTES E INTEGRA√á√ÉO

**Respons√°vel:** IA Testes  
**Dura√ß√£o:** 2-3 horas  
**Gate:** Testes passando
**Depend√™ncias:** Backend pronto
**Pode executar em paralelo com Frontend**

### **Objetivos**
- Criar suite de testes completa
- Validar integra√ß√£o frontend-backend
- Documentar casos de uso
- Garantir seguran√ßa e performance

### **Tipos de Testes**

#### 4.1 Testes de API
- [ ] Testes de endpoints (Postman/Insomnia)
- [ ] Valida√ß√£o de schemas
- [ ] Casos de erro (400, 401, 403, 404, 500)
- [ ] Limites e pagina√ß√£o

#### 4.2 Testes de Integra√ß√£o
- [ ] Fluxo completo CRUD
- [ ] Valida√ß√£o de permiss√µes por perfil
- [ ] Multi-tenant (isolamento por loja)
- [ ] Relacionamentos funcionando

#### 4.3 Testes de Performance
- [ ] Queries sem N+1
- [ ] Tempo de resposta adequado
- [ ] Pagina√ß√£o eficiente
- [ ] Cache quando aplic√°vel

#### 4.4 Testes de Seguran√ßa
- [ ] Autentica√ß√£o obrigat√≥ria
- [ ] Autoriza√ß√£o por perfil
- [ ] SQL Injection prevention
- [ ] XSS prevention

### **Documenta√ß√£o de Testes**
```markdown
## TESTES - M√ìDULO [NOME]

### Casos de Sucesso
1. Criar registro: [passos]
2. Listar com filtros: [passos]
3. Atualizar parcial: [passos]
4. Excluir (soft): [passos]

### Casos de Erro
1. Criar duplicado: [resultado esperado]
2. Acessar sem permiss√£o: [resultado]
3. Dados inv√°lidos: [valida√ß√µes]

### Performance
- Listagem 100 registros: [tempo]
- Query com joins: [otimizada?]
```

### **üü° GATE: Testes aprovados**
- Todos os testes passando
- Performance adequada
- Seguran√ßa validada

---

## ‚úÖ FASE 4: VALIDA√á√ÉO FINAL

**Respons√°vel:** Claude Code (Gerente)  
**Dura√ß√£o:** 1-2 horas  
**Gate:** Aprova√ß√£o final do Ricardo
**Depend√™ncias:** Frontend + Integra√ß√£o prontos

### **Objetivos**
- Validar sistema completo funcionando
- Verificar qualidade do c√≥digo
- Confirmar dados reais do Supabase
- Preparar para produ√ß√£o

### **Checklist Final**

#### 5.1 Funcionalidades
- [ ] CRUD completo funcionando
- [ ] Filtros e busca operacionais
- [ ] Pagina√ß√£o correta
- [ ] Ordena√ß√£o funcionando
- [ ] Valida√ß√µes aplicadas

#### 5.2 Qualidade
- [ ] C√≥digo comentado em PT-BR
- [ ] Sem console.log desnecess√°rios
- [ ] Tratamento de erros completo
- [ ] Loading states adequados
- [ ] Mensagens em portugu√™s

#### 5.3 Integra√ß√£o
- [ ] Dados reais do Supabase
- [ ] Sem mocks em produ√ß√£o
- [ ] Cache invalidado corretamente
- [ ] Estados sincronizados

#### 5.4 Seguran√ßa
- [ ] Permiss√µes testadas por perfil
- [ ] Multi-tenant funcionando
- [ ] Sem vazamento de dados
- [ ] Logs de auditoria

### **Demonstra√ß√£o para Ricardo**
1. Criar novo registro
2. Listar com filtros
3. Editar registro existente
4. Excluir com confirma√ß√£o
5. Mostrar valida√ß√µes
6. Testar permiss√µes

### **üü¢ GATE: Aprova√ß√£o Final**
- Ricardo testa pessoalmente
- Feedback incorporado
- Pronto para produ√ß√£o

---

## üìä PROCESSO DE REVIS√ÉO E NOTA (CLAUDE CODE)

### **Crit√©rios de Avalia√ß√£o (Vis√£o S√™nior Conservador)**

| Crit√©rio | Peso | Descri√ß√£o |
|----------|------|-----------|
| **Funcionalidade** | 30% | Funciona conforme especificado? |
| **Qualidade do C√≥digo** | 25% | Limpo, manuten√≠vel, sem gambiarras? |
| **Performance** | 20% | Otimizado, sem N+1, resposta r√°pida? |
| **Seguran√ßa** | 15% | Valida√ß√µes, permiss√µes, sem vulnerabilidades? |
| **Documenta√ß√£o** | 10% | Coment√°rios, tipos, f√°cil entender? |

### **Escala de Notas**

- **9-10:** Excelente, pronto para produ√ß√£o
- **7-8:** Bom, pequenos ajustes necess√°rios
- **5-6:** Regular, precisa refatora√ß√£o moderada
- **3-4:** Ruim, refatora√ß√£o significativa
- **1-2:** Cr√≠tico, reescrever do zero

### **Processo de Decis√£o**

```
NOTA >= 7 com ajustes pequenos?
‚îú‚îÄ‚îÄ SIM ‚Üí Claude pergunta: "Posso refatorar diretamente?"
‚îÇ   ‚îú‚îÄ‚îÄ Ricardo SIM ‚Üí Claude refatora
‚îÇ   ‚îî‚îÄ‚îÄ Ricardo N√ÉO ‚Üí Claude cria demanda
‚îî‚îÄ‚îÄ N√ÉO ‚Üí Claude cria demanda detalhada de refatora√ß√£o
```

### **Template de Revis√£o**

```markdown
## REVIS√ÉO - M√ìDULO [NOME]

### Nota Final: X/10

### An√°lise por Crit√©rio:
- Funcionalidade: X/10 - [justificativa]
- C√≥digo: X/10 - [justificativa]
- Performance: X/10 - [justificativa]
- Seguran√ßa: X/10 - [justificativa]
- Documenta√ß√£o: X/10 - [justificativa]

### Problemas Encontrados:
1. [Problema 1 - Severidade]
2. [Problema 2 - Severidade]

### Recomenda√ß√£o:
[ ] Aprovado como est√°
[ ] Pequenos ajustes (posso fazer)
[ ] Refatora√ß√£o necess√°ria (criar demanda)

Ricardo, como deseja proceder?
```

---

## üìà CONTROLE DE PROGRESSO

### **Template de Status**
```markdown
## STATUS - M√ìDULO [NOME]

### ‚úÖ CONCLU√çDO
- [ ] Fase 1: Descoberta

### üîÑ EM PROGRESSO
- [ ] Fase 2: Backend (50%)

### üîí BLOQUEADO
- [ ] Fase 3A: Frontend (aguarda backend)
- [ ] Fase 3B: Integra√ß√£o (aguarda backend)
- [ ] Fase 4: Valida√ß√£o (aguarda 3A e 3B)

### üìÖ TIMELINE
- In√≠cio: [data]
- Previs√£o: [data]
- Bloqueios: [descri√ß√£o]
```

---

## üö® REGRAS IMPORTANTES

1. **NUNCA** pular fases ou gates
2. **SEMPRE** usar m√≥dulos existentes como refer√™ncia
3. **REMOVER** todos os mocks antes de entregar
4. **DOCUMENTAR** decis√µes e mudan√ßas
5. **TESTAR** antes de marcar como pronto

---

## üìö REFER√äNCIAS

- **M√≥dulo Exemplo:** `/backend/modules/lojas/`
- **Frontend Exemplo:** `/Frontend/src/components/modulos/lojas/`
- **Tipos:** `/Frontend/src/types/`
- **Documenta√ß√£o API:** `http://localhost:8000/docs`

---

**Este processo garante qualidade, rastreabilidade e sucesso na integra√ß√£o de novos m√≥dulos!**